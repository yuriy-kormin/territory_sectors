{% extends "base.html" %}
{% load i18n %}
{% load qr_code %}
{% load bootstrap4 %}
{% load static %}
{% block page_content %}
    <form method="post" action=".">
    {% csrf_token %}
    {% if object.uuid_id %}
        {% with request.scheme|add:"://"|add:request.get_host|add:'/'|add:object.uuid_id as url_string %}
            {% qr_from_text url_string size="t" image_format="png" error_correction="L" %}
        {% endwith %}
{#        <img src="data:image/png;base64,{{ qr_img_data }}">#}
    <a href="{% url "uuid" object.uuid_id %}">link</a>
    {% endif %}
        <h1 class="my-4"> {{ header }}</h1>
        <div class = "form">
            {%  for field in form %}
                <div class = "form-group">
                    {% bootstrap_field field %}
                    {% if field.name == 'uuid' %}
                        <div class = "form">
{#                                <button type="button" title="qq" id="myBtn" onclick="fetch({% url 'uuid_gen' %})">#}
{#                             {% bootstrap_button 'qq' href="onclick(fetch('uuid/gen')" button_class="mt-3 btn btn-primary" %}#}
{#                        <a class="btn mt-3 btn-primary" href="onclick(fetch('uuid/gen'))" role="button">qq</a>#}
                            <a href="{% url "uuid_gen" %}" target="_blank" rel="noopener">create uuid</a>
                        </div>
                    {% endif %}
{#                    {% if field.name %}{% endif %}#}
                </div>
            {% endfor %}
                {% if object %}
{#                    {% for house in object.get_houses_into %}#}
{#                        {{ house.address.as_div }}#}
{#                    {% endfor %}#}
                {% endif %}
                <div class = "form-group">
                     {% bootstrap_button button_title button_type="submit" button_class="mt-3 btn btn-primary" %}
                </div>
        </div>
        <input type="hidden" id="id" value="{{ house.id|default:'0' }}">
    </form>
{#    <button type="button" title="qq" id="myBtn" onclick="create_uuid()">#}
{% endblock %}
{% block head %}
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.2/mapbox-gl-draw.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.2/mapbox-gl-draw.css" type="text/css">
{% endblock %}
{% block markers %}
    add_draw_control()
    map.on('draw.update', update_sector);
    map.on('draw.create', update_sector);
    {% include "sector/houses_circles.html" %}
    {% if object %}
        map_fly({{ object.centroid.coords.0 }},{{ object.centroid.coords.1 }})
{#        add_sector_source({{ object.id }},{{ object.geojson | safe }},"{{ object.name }}")#}
        {% for sector in sectors %}
            add_sector_source({{ sector.id }}, {{ object.geojson | safe }}, "{{ sector.name }}")
        {% endfor %}
        map.on('load', map_add_layer)
        draw.add(sectors)
    {% endif %}
{% endblock %}
